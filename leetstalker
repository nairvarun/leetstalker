#! /bin/python3

# TODO:
    # multithread
    # format output

import requests
import json
from pprint import pprint


def main():
    url = 'https://leetcode.com/graphql/'

    headers = {
        'Content-Type': 'application/json',
    }

    unames = [
        'nairvarun',
        'gultandon',
        'user5491H',
        'samsepi0x0',
        'suryanssshhh',
        'tkj2410',
        'chadasaisaketh'
    ]

    for uname in unames:
        query(url, headers, uname)

def query(url, headers, uname):
    ranking_data = {
        'query': '''
            query userPublicProfile($username: String!) {
                matchedUser(username: $username) {
                    profile {
                        ranking
                    }
                }
            }
        ''',
        'variables': {
            'username': f'{uname}',
        }
    }

    solved_data = {
        'query': '''
            query userProblemsSolved($username: String!) {
                matchedUser(username: $username) {
                    submitStatsGlobal {
                        acSubmissionNum {
                            difficulty
                            count
                        }
                    }
                }
            }
        ''',
        'variables': {
            'username': f'{uname}',
        }
    }

    ranking_response = requests.post(url, headers=headers, json=ranking_data)
    solved_response = requests.post(url, headers=headers, json=solved_data)

    ranking = json.loads(ranking_response.text)
    solved = json.loads(solved_response.text)

    res = {
        'uname': uname,
        'rank': ranking['data']['matchedUser']['profile']['ranking'],
        'solved': {
            'total': solved['data']['matchedUser']['submitStatsGlobal']['acSubmissionNum'][0]['count'],
            'easy': solved['data']['matchedUser']['submitStatsGlobal']['acSubmissionNum'][1]['count'],
            'medium': solved['data']['matchedUser']['submitStatsGlobal']['acSubmissionNum'][2]['count'],
            'hard': solved['data']['matchedUser']['submitStatsGlobal']['acSubmissionNum'][3]['count'],
        }
    }
    pprint(res)

if __name__ == "__main__":
    main()
